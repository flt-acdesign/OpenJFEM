<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenJFEM Tools Guide</title>
    <style>
        :root {
            --bg: #1a1a2e; --surface: #16213e; --card: #1c2a4a;
            --accent: #00d4ff; --accent2: #ff8a65; --text: #e0e0e0; --dim: #8899aa;
            --border: #2a3a5a; --code-bg: #0d1b2a; --success: #66bb6a; --warn: #ffa726;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; }

        .hero {
            background: linear-gradient(135deg, #0d1b2a 0%, #1a1a2e 50%, #16213e 100%);
            padding: 60px 40px 40px; text-align: center; border-bottom: 2px solid var(--accent);
        }
        .hero h1 { font-size: 2.4em; color: #fff; margin-bottom: 8px; letter-spacing: 1px; }
        .hero h1 span { color: var(--accent); }
        .hero .subtitle { font-size: 1.1em; color: var(--dim); max-width: 600px; margin: 0 auto; }

        .container { max-width: 960px; margin: 0 auto; padding: 30px 20px; }

        .nav { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 30px 0; }
        .nav a {
            padding: 8px 18px; border-radius: 20px; background: var(--card); color: var(--accent);
            text-decoration: none; font-size: 0.9em; border: 1px solid var(--border); transition: all 0.2s;
        }
        .nav a:hover { background: var(--accent); color: #000; }

        h2 {
            font-size: 1.6em; color: var(--accent); margin: 40px 0 15px; padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        h3 { font-size: 1.2em; color: var(--accent2); margin: 25px 0 10px; }
        h4 { font-size: 1em; color: var(--success); margin: 15px 0 8px; }

        p { margin-bottom: 12px; }

        pre {
            background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px;
            padding: 15px 18px; overflow-x: auto; margin: 10px 0 18px; font-size: 0.92em; line-height: 1.6;
        }
        code { font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace; color: var(--accent); }
        pre code { color: var(--text); }
        .cmd { color: var(--success); } .arg { color: var(--accent); } .comment { color: var(--dim); }

        table { width: 100%; border-collapse: collapse; margin: 10px 0 20px; }
        th { background: var(--card); color: var(--accent); text-align: left; padding: 10px 14px; font-size: 0.9em; border: 1px solid var(--border); }
        td { padding: 8px 14px; border: 1px solid var(--border); font-size: 0.9em; }
        tr:nth-child(even) td { background: rgba(0,0,0,0.15); }

        .card {
            background: var(--card); border: 1px solid var(--border); border-radius: 8px;
            padding: 20px; margin: 15px 0;
        }
        .card-title { color: var(--accent); font-weight: bold; font-size: 1.05em; margin-bottom: 8px; }

        .tag {
            display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold;
            margin-right: 6px;
        }
        .tag-converter { background: #1b3a2f; color: #66bb6a; }
        .tag-comparison { background: #3a2a1b; color: #ffa726; }
        .tag-testing { background: #1b2a3a; color: #42a5f5; }

        .workflow {
            background: var(--surface); border-left: 3px solid var(--accent); padding: 15px 20px;
            margin: 15px 0; border-radius: 0 6px 6px 0;
        }
        .workflow .step { margin: 8px 0; }
        .workflow .step-num {
            display: inline-block; width: 24px; height: 24px; border-radius: 50%;
            background: var(--accent); color: #000; text-align: center; line-height: 24px;
            font-size: 0.8em; font-weight: bold; margin-right: 8px;
        }

        .tip {
            background: rgba(0, 212, 255, 0.08); border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px; padding: 12px 16px; margin: 12px 0; font-size: 0.92em;
        }
        .tip::before { content: "\1F4A1 "; }

        .warn {
            background: rgba(255, 167, 38, 0.08); border: 1px solid rgba(255, 167, 38, 0.3);
            border-radius: 6px; padding: 12px 16px; margin: 12px 0; font-size: 0.92em;
        }
        .warn::before { content: "\26A0\FE0F "; }

        .dir-tree { font-family: monospace; font-size: 0.9em; line-height: 1.8; color: var(--dim); }
        .dir-tree .folder { color: var(--accent); font-weight: bold; }
        .dir-tree .file { color: var(--text); }
        .dir-tree .desc { color: var(--dim); font-style: italic; }
    </style>
</head>
<body>

<div class="hero">
    <h1>OpenJFEM <span>Tools Guide</span></h1>
    <p class="subtitle">Converters, comparison utilities, and test runners for the OpenJFEM solver</p>
</div>

<div class="container">

<div class="nav">
    <a href="#overview">Overview</a>
    <a href="#converters">Converters</a>
    <a href="#comparison">Comparison</a>
    <a href="#testing">Testing</a>
    <a href="#benchmark">Benchmark</a>
    <a href="#workflows">Workflows</a>
</div>

<!-- ================================================================ -->
<h2 id="overview">Directory Structure</h2>

<div class="dir-tree">
<pre>
tools/
  <span class="folder">converters/</span>
    <span class="file">nastran_to_mystran.jl</span>   <span class="desc">Convert BDF to MYSTRAN format and run MYSTRAN</span>
    <span class="file">f06_2_json.jl</span>           <span class="desc">Parse F06 text output to structured JSON</span>
    <span class="file">HDF5_2_VTK.jl</span>           <span class="desc">Convert HDF5 binary results to VTK</span>
  <span class="folder">comparison/</span>
    <span class="file">compare_results.jl</span>      <span class="desc">Full statistical comparison (correlation, L2, errors)</span>
    <span class="file">compare_OpenJFEM.jl</span>       <span class="desc">Displacement comparison for OpenJFEM model</span>
    <span class="file">quick_compare.jl</span>        <span class="desc">Quick summary comparison</span>
    <span class="file">detailed_compare.jl</span>     <span class="desc">Per-node / per-DOF detailed comparison</span>
  <span class="folder">testing/</span>
    <span class="file">run_mystran_tests.jl</span>    <span class="desc">Automated batch test runner</span>
    <span class="file">verify_all.jl</span>           <span class="desc">Comprehensive regression suite</span>
    <span class="file">verify_tests.jl</span>         <span class="desc">Single-test verification</span>
  <span class="file">benchmark.jl</span>              <span class="desc">Performance benchmarking (MYSTRAN vs Julia)</span>
</pre>
</div>

<div class="tip">
All scripts are run from the OpenJFEM root directory using <code>julia --project=.</code> to ensure dependencies are loaded correctly.
</div>

<!-- ================================================================ -->
<h2 id="converters">Converters</h2>

<!-- nastran_to_mystran -->
<h3><span class="tag tag-converter">CONVERTER</span> nastran_to_mystran.jl</h3>

<p>Converts a BDF input file to MYSTRAN-compatible format, optionally runs MYSTRAN, and collects all output files into a dedicated results folder. This is the primary tool for cross-validation.</p>

<h4>Usage</h4>
<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/nastran_to_mystran.jl <span class="arg">&lt;input.bdf&gt;</span> [mystran_exe_path]</code></pre>

<h4>What it does</h4>
<ol style="margin: 8px 0 12px 24px;">
    <li>Reads the input BDF file</li>
    <li>Writes a MYSTRAN-compatible version as <code>&lt;name&gt;.MYSTRAN.bdf</code></li>
    <li>Injects K6ROT drilling stiffness via CELAS2 springs at shell nodes</li>
    <li>Runs the MYSTRAN executable</li>
    <li>Collects all MYSTRAN output files into <code>&lt;name&gt;_MYST_RESULTS/</code></li>
    <li>Runs OpenJFEM on the MYSTRAN F06 to produce a comparison <code>.jfem</code> file</li>
</ol>

<h4>Output</h4>
<table>
    <tr><th>File</th><th>Description</th></tr>
    <tr><td><code>&lt;name&gt;.MYSTRAN.bdf</code></td><td>Converted MYSTRAN input file</td></tr>
    <tr><td><code>&lt;name&gt;_MYST_RESULTS/</code></td><td>Directory with all MYSTRAN output files</td></tr>
    <tr><td><code>&lt;name&gt;.MYSTRAN.jfem</code></td><td>JFEM binary of MYSTRAN results (for LUDWIG comparison)</td></tr>
</table>

<h4>Example</h4>
<pre><code><span class="comment"># Convert and run MYSTRAN on the fwing model</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/nastran_to_mystran.jl models/fwing/fwing.bdf

<span class="comment"># Specify a custom MYSTRAN executable path</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/nastran_to_mystran.jl models/ala3/ala3.bdf /path/to/mystran.exe</code></pre>

<div class="tip">
The MYSTRAN executable path can also be set via the <code>MYSTRAN_EXE</code> environment variable.
</div>

<!-- f06_2_json -->
<h3><span class="tag tag-converter">CONVERTER</span> f06_2_json.jl</h3>

<p>Parses an F06 formatted text output file and extracts displacements, SPC forces, element forces, and stresses into a structured JSON file. This is used internally by the comparison and testing tools.</p>

<h4>Usage</h4>
<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/f06_2_json.jl <span class="arg">&lt;model_name&gt;</span></code></pre>

<h4>Output</h4>
<p>Produces a <code>&lt;name&gt;.NAST.json</code> file with parsed results organized by subcase.</p>

<!-- HDF5_2_VTK -->
<h3><span class="tag tag-converter">CONVERTER</span> HDF5_2_VTK.jl</h3>

<p>Converts HDF5 binary results to VTK format for visualization in ParaView.</p>

<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/HDF5_2_VTK.jl <span class="arg">&lt;input.h5&gt;</span></code></pre>

<!-- ================================================================ -->
<h2 id="comparison">Comparison Tools</h2>

<p>These tools compare OpenJFEM results against reference outputs to validate solver accuracy. They compute statistical metrics including correlation coefficients, L2 norms, and per-DOF error percentages.</p>

<!-- compare_results -->
<h3><span class="tag tag-comparison">COMPARISON</span> compare_results.jl</h3>

<p>The most comprehensive comparison tool. Computes full statistical metrics across all result fields.</p>

<h4>Metrics Computed</h4>
<table>
    <tr><th>Metric</th><th>Description</th></tr>
    <tr><td><code>max_ref</code></td><td>Maximum absolute reference value</td></tr>
    <tr><td><code>max_diff</code></td><td>Maximum absolute difference</td></tr>
    <tr><td><code>mean_diff_pct</code></td><td>Mean percentage difference (significant values only)</td></tr>
    <tr><td><code>median_ratio</code></td><td>Median of test/reference ratios</td></tr>
    <tr><td><code>l2_ratio</code></td><td>L2 norm ratio (test / reference)</td></tr>
    <tr><td><code>sign_err_pct</code></td><td>Percentage of sign errors</td></tr>
    <tr><td><code>corr_coeff</code></td><td>Pearson correlation coefficient</td></tr>
</table>

<h4>Usage</h4>
<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/compare_results.jl <span class="arg">OpenJFEM</span></code></pre>

<div class="tip">
Values below the significance threshold (0.1% of max) are automatically filtered to avoid noise from near-zero comparisons.
</div>

<!-- quick_compare -->
<h3><span class="tag tag-comparison">COMPARISON</span> quick_compare.jl</h3>

<p>Fast summary comparison showing displacement L2 norms and key correlation metrics. Ideal for quick validation during development.</p>

<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/quick_compare.jl <span class="arg">fwing</span></code></pre>

<!-- detailed_compare -->
<h3><span class="tag tag-comparison">COMPARISON</span> detailed_compare.jl</h3>

<p>Per-node, per-DOF detailed comparison. Lists the nodes with the largest discrepancies and provides individual error breakdowns. Useful for debugging specific regions of a model.</p>

<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/detailed_compare.jl <span class="arg">OpenJFEM</span></code></pre>

<!-- compare_OpenJFEM -->
<h3><span class="tag tag-comparison">COMPARISON</span> compare_OpenJFEM.jl</h3>

<p>Specialized displacement comparison for the OpenJFEM reference model.</p>

<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/compare_OpenJFEM.jl</code></pre>

<!-- ================================================================ -->
<h2 id="testing">Testing</h2>

<!-- verify_all -->
<h3><span class="tag tag-testing">TESTING</span> verify_all.jl</h3>

<p>Comprehensive regression test suite. Runs OpenJFEM on each test model, parses the MYSTRAN reference F06 output, and compares displacements, SPC forces, and element results.</p>

<h4>Usage</h4>
<pre><code><span class="comment"># Run all tests</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/verify_all.jl</code></pre>

<h4>What it checks</h4>
<ul style="margin: 8px 0 12px 24px;">
    <li>Displacement correlation per DOF (T1, T2, T3, R1, R2, R3)</li>
    <li>SPC reaction force agreement</li>
    <li>Maximum error percentages</li>
    <li>Pass/fail status for each model</li>
</ul>

<!-- run_mystran_tests -->
<h3><span class="tag tag-testing">TESTING</span> run_mystran_tests.jl</h3>

<p>Automated batch test runner. Runs OpenJFEM on BDF files, parses MYSTRAN reference F06 outputs, and compares results with detailed per-field statistics.</p>

<pre><code><span class="comment"># Run all available tests</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/run_mystran_tests.jl <span class="arg">all</span>

<span class="comment"># Run a specific test</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/run_mystran_tests.jl <span class="arg">fwing</span></code></pre>

<!-- verify_tests -->
<h3><span class="tag tag-testing">TESTING</span> verify_tests.jl</h3>

<p>Single-test verification utility for quick checks on individual models.</p>

<pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/verify_tests.jl <span class="arg">models/ala3/ala3.bdf</span></code></pre>

<!-- ================================================================ -->
<h2 id="benchmark">Benchmark</h2>

<h3><span class="tag tag-testing">BENCHMARK</span> benchmark.jl</h3>

<p>Measures wall-clock time for solver runs on the three main test models (ala3, fwing, OpenJFEM). Compares MYSTRAN execution time vs OpenJFEM.</p>

<pre><code><span class="comment"># Run both solvers</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/benchmark.jl <span class="arg">both</span>

<span class="comment"># Run only OpenJFEM</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/benchmark.jl <span class="arg">julia</span>

<span class="comment"># Run only MYSTRAN</span>
<span class="cmd">julia</span> <span class="arg">--project=.</span> tools/benchmark.jl <span class="arg">mystran</span></code></pre>

<!-- ================================================================ -->
<h2 id="workflows">Common Workflows</h2>

<h3>Workflow 1: Solve and Visualize a Model</h3>
<div class="workflow">
    <div class="step"><span class="step-num">1</span> Run the solver on your BDF file</div>
    <pre><code><span class="cmd">julia</span> -t auto <span class="arg">--project=.</span> src/main.jl models/fwing/fwing.bdf</code></pre>
    <div class="step"><span class="step-num">2</span> Open <code>POST/postv11.html</code> in your browser</div>
    <div class="step"><span class="step-num">3</span> Load the generated <code>fwing.jfem</code> file</div>
    <div class="step"><span class="step-num">4</span> Explore results using deformation scale, color fields, and display options</div>
</div>

<h3>Workflow 2: Compare OpenJFEM vs MYSTRAN</h3>
<div class="workflow">
    <div class="step"><span class="step-num">1</span> Run OpenJFEM on the model</div>
    <pre><code><span class="cmd">julia</span> -t auto <span class="arg">--project=.</span> src/main.jl models/fwing/fwing.bdf</code></pre>
    <div class="step"><span class="step-num">2</span> Convert to MYSTRAN format and run MYSTRAN</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/nastran_to_mystran.jl models/fwing/fwing.bdf</code></pre>
    <div class="step"><span class="step-num">3</span> Open LUDWIG post-processor and load both JFEM files</div>
    <p style="margin: 4px 0 4px 36px; font-size: 0.95em;">
        Load <code>fwing.jfem</code> as <strong style="color:#4fc3f7;">Model A</strong> and
        <code>fwing.MYSTRAN.jfem</code> as <strong style="color:#ff8a65;">Model B</strong>
    </p>
    <div class="step"><span class="step-num">4</span> Use the <strong>Vis</strong> tab to offset and compare models visually</div>
    <div class="step"><span class="step-num">5</span> Run numerical comparison</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/quick_compare.jl fwing</code></pre>
</div>

<h3>Workflow 3: Full Regression Test</h3>
<div class="workflow">
    <div class="step"><span class="step-num">1</span> Run the complete test suite</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/verify_all.jl</code></pre>
    <div class="step"><span class="step-num">2</span> Review pass/fail results for each model</div>
    <div class="step"><span class="step-num">3</span> For any failures, run detailed comparison</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/comparison/detailed_compare.jl <span class="arg">&lt;model_name&gt;</span></code></pre>
</div>

<h3>Workflow 4: Add a New Test Case</h3>
<div class="workflow">
    <div class="step"><span class="step-num">1</span> Create a new directory under <code>models/</code> with your BDF file</div>
    <pre><code>mkdir models/my_new_test
cp my_model.bdf models/my_new_test/</code></pre>
    <div class="step"><span class="step-num">2</span> Run OpenJFEM</div>
    <pre><code><span class="cmd">julia</span> -t auto <span class="arg">--project=.</span> src/main.jl models/my_new_test/my_model.bdf</code></pre>
    <div class="step"><span class="step-num">3</span> Generate MYSTRAN reference (for cross-validation)</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/converters/nastran_to_mystran.jl models/my_new_test/my_model.bdf</code></pre>
    <div class="step"><span class="step-num">4</span> Verify results</div>
    <pre><code><span class="cmd">julia</span> <span class="arg">--project=.</span> tools/testing/verify_tests.jl models/my_new_test/my_model.bdf</code></pre>
</div>

<div class="warn">
MYSTRAN must be installed separately. Set the <code>MYSTRAN_EXE</code> environment variable or pass the executable path as a command-line argument.
</div>

<!-- ================================================================ -->
<div style="margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center; color: var(--dim); font-size: 0.85em;">
    OpenJFEM Tools Guide &mdash; see also <a href="../POST/POST_GUIDE.html" style="color: var(--accent);">POST_GUIDE.html</a> for post-processor documentation
</div>

</div>
</body>
</html>
